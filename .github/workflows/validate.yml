name: Pipeline Estándar Profesional
on: [push]

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  quality-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # 1. HTMLHint: Revisa accesibilidad y etiquetas obsoletas
      - name: Linter de Buenas Prácticas (HTMLHint)
        run: |
          npm install -g htmlhint
          htmlhint "**/*.html" --rules "tag-pair=true,id-unique=true,src-not-empty=true,attr-value-not-empty=true,doctype-first=true,tag-self-close=false,spec-char-escape=false"

      # 3. ESLint: Detecta errores de lógica y sintaxis en JS
      - name: Validador de JavaScript (ESLint)
        run: |
          npm install -g eslint
          npx eslint "**/*.js" --no-eslintrc --rule 'no-undef: error' --rule 'no-unused-vars: warn' --allow-empty-files || true

  deploy:
    needs: quality-check
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - uses: actions/checkout@v4
      - name: Setup Pages
        uses: actions/configure-pages@v4
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '.'
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4